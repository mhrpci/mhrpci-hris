import{P as c,E as n}from"./pusher-C-l6VMg8.js";window.Pusher=c;window.Echo=new n({broadcaster:"pusher",key:"c8c357e8e1563543b8b2",cluster:"ap1",forceTLS:!0});const i=document.querySelector('meta[name="user-id"]').getAttribute("content");i?n.private(`App.Models.User.${i}`).notification(t=>{new Notification(t.title,{body:t.body})}):console.error("User ID not found");Notification.permission==="default"?Notification.requestPermission().then(t=>{console.log(t==="granted"?"Notification permission granted.":"Notification permission denied.")}):Notification.permission==="denied"?alert("Notifications are blocked. Please enable them in your browser settings."):console.log("Notification permission already granted.");window.Echo.private("notifications").listen("RealTimeNotification",t=>{s(t.notification),Notification.permission==="granted"&&r(t.notification),playNotificationSound()});function s(t){const o=document.getElementById("notification-badge"),e=parseInt(o.textContent||"0");o.textContent=e+1,addNotificationToDropdown(t)}function r(t){const o={body:t.text,icon:"/path/to/icon.png",badge:"/path/to/badge.png",vibrate:[200,100,200]};new Notification(t.title,o)}document.addEventListener("DOMContentLoaded",function(){let t=new Date().toISOString();function o(){setInterval(()=>{fetch(`/notifications/updates?last_check=${t}`).then(e=>e.json()).then(e=>{e.notifications.length>0&&(updateNotificationList(e.notifications),updateNotificationCount(e.count),showNotificationToast(e.notifications[0])),t=new Date().toISOString()})},3e4)}o(),document.addEventListener("click",function(e){if(e.target.closest(".notification-item")){const a=e.target.closest(".notification-item").dataset.id;fetch(`/notifications/${a}/read`,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}})}}),document.getElementById("mark-all-read").addEventListener("click",function(){fetch("/notifications/mark-all-read",{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}).then(()=>{updateNotificationCount(0),document.querySelectorAll(".notification-item.unread").forEach(e=>{e.classList.remove("unread")})})})});
